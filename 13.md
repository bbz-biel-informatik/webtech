# Web-Technologie

## Animation & Interaktion



## Programm

* Gravitation
* Kollisionen



## PhysiJS

* Javascript-Physik-Simulator
* Einige Änderungen am Code nötig
* Unterstützt Gravitation, Kollisionen usw
* [Dokumentation](https://github.com/chandlerprall/Physijs/wiki)


## Einrichtung

* `physi.js` in `<script>`-Tag einbinden
* `Physijs.scripts.worker` und `Physijs.scripts.ammo` definieren
* Szene und Meshes anders definieren



## 1 PhysiJS einbinden

[Datei](https://raw.githubusercontent.com/chandlerprall/Physijs/master/physi.js) in Ordner ablegen und nach `three.js` im HTML-Head einbinden:

    <script type="text/javascript" src="physi.js"></script>


## 2 Worker und Ammo definieren

Dateien herunterladen: [ammo.js](https://raw.githubusercontent.com/kripken/ammo.js/master/builds/ammo.js), [physijs_worker.js](https://github.com/chandlerprall/Physijs/raw/master/physijs_worker.js), in gleichen Ordner legen

Zu Beginn des JS-Codes folgende Variablen setzen (Pfad zu Dateien):

```js
Physijs.scripts.worker = 'physijs_worker.js';
Physijs.scripts.ammo = 'ammo.js';
```


## 3 Szene ersetzen

```js
scene = new THREE.Scene();
```
 ersetzen mit

 ```js
scene = new Physijs.Scene();
 ```


## 4 Objekte ersetzen

Mesh-Generation jeweils mit der Form ersetzen, deren physikalische Eigenschaften das Objekt haben soll:

```js
cube = new THREE.Mesh(geometry, material);
```

```js
box = new Physijs.BoxMesh(geometry, material);
```


## 5 Simulation starten

Im Game-Loop, vor dem Aufruf von `renderer.render()`:

```js
scene.simulate();
```


## Mögliche Formen

* BoxMesh
* SphereMesh
* CylinderMesh
* ConeMesh
* CapsuleMesh

[Alle](https://github.com/chandlerprall/Physijs/wiki/Basic-Shapes)



## Gravitation

Gravitation muss nach dem Erstellen der Szene aktiviert werden.

```js
var scene = ...
scene.setGravity();
```

oder in beliebige Richtung/beliebiger Kraft:

```js
scene.setGravity(new THREE.Vector3( x_kraft, y_kraft, z_kraft ));
```

Standard: `(0, -10, 0)`


## Gewicht der Objekte definieren

Objekte müssen für Simulation ein Gewicht haben. Das Gewicht kann als dritte Variable an Physijs.Mesh übergeben werden:

```js
new Physijs.BoxMesh( geometry, material, masse );
```

Für statische Objekte (Wände, Böden): Masse auf `0` setzen



## Kollisionen

Nach dem Erstellen eines Physijs-Objekts kann ein Ereignishandler für Kollisionen definiert werden:

```js
cube = new Physijs.CubeMesh(geometry, material, masse);

cube.addEventListener( 'collision', handle_collision );

function handle_collision( other_object, relative_velocity,
                           relative_rotation, contact_normal ) {
    // Code
}
```

* `other_object`: das andere Objekt der Kollision
* `relative_velocity`: Auftreff-Geschwindigkeit
* `relative_rotation`: Drehkraft nach Kollision
* `contact_normal`: Auftreffrichtung
